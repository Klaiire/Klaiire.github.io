<!DOCTYPE html>
<html>
<title>Magic Shop. Catalog</title>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  <meta content="utf-8" http-equiv="encoding" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <script type="text/javascript" src="utils.js"></script>
  <link rel="stylesheet" href="styles.css" />
  
  <!-- Un-comment the block to enable Google Tag Manager Data Layer-->
    <script>
    window.dataLayer = window.dataLayer || [];
    </script>

  
   <!-- Un-comment the block to enable Google Tag Manager  and replace the GTM id with your own-->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NC4H9LB');</script>
  
<!--IB LC script-->
<script>
  (function(I,n,f,o,b,i,p){
  I[b]=I[b]||function(){(I[b].q=I[b].q||[]).push(arguments)};
  I[b].t=1*new Date();i=n.createElement(f);i.async=1;i.src=o;
  p=n.getElementsByTagName(f)[0];p.parentNode.insertBefore(i,p)})
  (window,document,'script','https://livechat.infobip.com/widget.js','liveChat');
  
  liveChat('init', '3e77dc08-fac2-4062-96fe-0a467ed2fca2');
  </script>
  
  <script>
  (function(I,n,f,o,b,i,p){
  I[b]=I[b]||function(){(I[b].q=I[b].q||[]).push(arguments)};
  I[b].t=1*new Date();i=n.createElement(f);i.async=1;i.src=o;
  p=n.getElementsByTagName(f)[0];p.parentNode.insertBefore(i,p)})
  (window,document,'script','https://webpush.infobip.com/bundle-latest.js','infobipWebPush');

  infobipWebPush('init', {
    applicationCode: '004c31d2823f6c11fcfc0c003a5b31b7-32607e99-a50a-4c27-8610-14713dbe3554',
    vapidPublicKey: 'BL_TvzYWKFP6SKbD-My4lkmbZXnk9J3Kx2cM6WZc_9h6ApqyIRRRNXTg8DJyUqifrCfMsDy_uk3U9rUAhBeFNZA=',
    optIn: {
      autostart: true,
    },
  });
    
      infobipWebPush("on", "browserRegistered", function (registration) {

              console.log(

                "browserRegistered",

                registration,

                registration.details.pushRegId

              );
</script>
  




             // let identity = {};

           //   if (type === "Phone") identity = { identity: { phoneNumber: phone } };

             // else if (type === "Email")

              //  identity = { identity: { email: email } };

            //  else if (type === "ExtId")

             //   identity = { identity: { externalId: extId } };



              // fetch(

              //   "https://16jmn.api.infobip.com/people/2/contactInformation/push/" +

              //     registration.details.pushRegId +

              //     "/personalize",

              //   {

              //     method: "POST",

              //     headers: {

              //       "Content-Type": "application/json",

              //       AppCode:

              //         "deed921ebc728f97f62797916ec9a8b3-1692ff05-514f-433a-9d38-55c67172f2b2",

              //       Authorization:

              //         "App 09686bc10c594ceac4f2c468dc2b26db-fbd58873-456c-4de7-989d-95af007ca63e",

              //     },

              //     body: JSON.stringify(identity),

              //   }

              // );

          //  });

</head>

<body>
  
<!-- Un-comment the block to enable Google Tag Manager and replace the GTM id with your own-->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NC4H9LB"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  
  <header class="header">
    <nav>
      <ul class="menu">
        <li><a class="delink delink-registration" href="./registration.html">
          <h1>Registration</h1>
        </a></li>
        <li>    <a class="delink delink-login" href="./login.html">
          <h1>Login</h1>
        </a></li>
        <li> <a class="delink delink-logout" onclick="logout()">
          <h1>Logout</h1>
        </a></li>
      </ul>
    </nav>
    <a class="delink" href="./">
      <h1>Chapeau Magique</h1>
    </a>
    <div class="counter">
      <a class="delink" id="cart" href="./checkout.html"></a>
    </div>
  </header>
  <article class="shop-content" id="shop">
    <div class="items-row">
      <div class="item-container">
        <div class="item"><a href="./products/1.html"><img class="image" src="images/hat01.jpg" alt="tophat" /></a>
        </div>
        <div>$52</div>
        <button class="button-add" type="button" onclick="addToCart('tophat', 52)">
          Add to cart
        </button>
      </div>
      <div class="item-container">
        <div class="item"><a href="./products/2.html"><img class="image" src="images/hat02.jpg" alt="bowlhat" /></a>
        </div>
        <div>$47</div>
        <button class="button-add" type="button" onclick="addToCart('bowlhat', 47)">
          Add to cart
        </button>
      </div>
      <div class="item-container">
        <div class="item"><a href="./products/3.html"><img class="image" src="images/hat03.jpg" alt="donegal" /></a>
        </div>
        <div>$33</div>
        <button class="button-add" type="button" onclick="addToCart('donegal', 33)">
          Add to cart
        </button>
      </div>
      <div class="item-container">
        <div class="item"><a href="./products/4.html"><img class="image" src="images/hat04.jpg" alt="fedora" /></a>
        </div>
        <div>$41</div>
        <button class="button-add" type="button" onclick="addToCart('fedora', 41)">
          Add to cart
        </button>
      </div>
    </div>
  </article>
  <script>
    async function addToCart(itemName, price) {
      addItemToCart(itemName, price);
      updateCartView('cart');

      const user = getUser();
      if (user && user.email) {
          // Trigger the Add to Cart event and pass product details as GTM variables
          window.dataLayer.push({'product_name': itemName, 'product_price': price, 'qty': 1, 'event': 'add_to_cart'});
          console.log('Item Added to Cart');
      } 
    }

    async function logout() {
      // Trigger the Logout event
      window.dataLayer.push({'user_id': '','event': 'logout'});
      console.log('User Logged Out');
      removeUser();
      
      setTimeout(() => window.location = './', 3000)
    }

    (async () => {
      const registrationLink = document.querySelector('.delink-registration');
      const loginLink = document.querySelector('.delink-login');
      const logoutLink =  document.querySelector('.delink-logout');
      logoutLink.style.display = 'none';

      const user = getUser();
      if (user && user.email) {
        registrationLink.style.display = 'none';
        loginLink.style.display = 'none';
        logoutLink.style.display = 'inline';
      }
      updateCartView('cart');
    })();
  </script>
</body>

</html>
